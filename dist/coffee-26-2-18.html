<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- File replaced by weekly-fundraiser.html -->
  <link rel="stylesheet" href="fixice.css?v=2">
  <style>
    body { font-family: sans-serif; background: #f8f8f8; margin: 0; padding: 0; }
    .container { max-width: 500px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 2em; }
    h1 { color: #0066cc; }
    label { display: block; margin-top: 1.5em; font-weight: bold; }
    input[type="number"] { width: 100%; padding: 0.5em; font-size: 1.1em; margin-top: 0.5em; }
    button { margin-top: 1.5em; background: #0066cc; color: #fff; border: none; padding: 0.7em 1.5em; border-radius: 4px; font-size: 1.1em; cursor: pointer; }
    .links { margin-top: 2em; }
    .links a { display: block; margin-bottom: 0.7em; color: #0066cc; text-decoration: underline; }
    .success { color: green; margin-top: 1em; }
    .tab-bar { display: flex; gap: 0; margin-bottom: 0; }
    .tab-btn {
      flex: 1; padding: 0.8em 0.5em; font-size: 1em; font-weight: bold;
      border: 2px solid #0066cc; background: #e8f0fe; color: #0066cc;
      cursor: pointer; border-bottom: none; border-radius: 8px 8px 0 0;
      margin: 0; transition: background 0.2s, color 0.2s;
    }
    .tab-btn.active { background: #0066cc; color: #fff; }
    .tab-btn:not(.active):hover { background: #d0e0f8; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body>
  <div id="menu-container"></div>
  <div class="container" style="padding-top:1em;">
    <h1 style="margin-bottom:0; text-align:center;">Coffee Connection â€” Feb 18, 2026</h1>
    <p style="font-style:italic; color:#555; margin-top:0.3em; margin-bottom:1.5em; text-align:center;">Caffeinate, Connect, and Contribute</p>
    <div class="tab-bar">
      <button class="tab-btn active" data-tab="fundraiser">Featured Fundraiser</button>
      <button class="tab-btn" data-tab="actions">Featured Actions</button>
    </div>

    <!-- Tab 1: Featured Fundraiser -->
    <div class="tab-content active" id="tab-fundraiser">
      <h1>Featured Fundraiser</h1>
      <p style="font-size:1.1em; color:#444; margin-bottom:1.5em;">Every Wednesday there will be a new fundraiser.</p>
      <form id="donation-form">
        <label for="amount">Donation Amount</label>
        <input type="number" id="amount" name="amount" min="1" step="any" placeholder="Enter amount (USD)" required>
        <div style="margin-top:1.5em; display:flex; gap:1em;">
          <button type="button" id="donate-once" style="flex:1; background:#0066cc;">Donate Once</button>
          <button type="button" id="donate-monthly" style="flex:1; background:#009966;">Donate Monthly</button>
        </div>
        <div class="success" id="success-message" style="display:none;">Thank you! Your donation has been recorded.</div>
      </form>
      <div class="links">
        <a href="https://givebutter.com/NSLUCE.html" target="_blank">Information about North Shore LUCE</a>
        <a href="https://givebutter.com/NSLUCE/donate.html" target="_blank">Donate to North Shore LUCE</a>
        <a href="https://lucemass.org.html" target="_blank">LUCE MA</a>
      </div>
      <button id="list-donations-btn" type="button" style="background:#888; margin-top:1em;">List All Donations</button>
      <div id="donations-list" style="margin-top:1.5em; display:none;"></div>
    </div>

    <!-- Tab 2: Featured Actions -->
    <div class="tab-content" id="tab-actions">
      <h1>Coffee Featured Actions</h1>
      <h2 style="color:#333; margin-top:1em;">Volunteer</h2>
      <p style="font-size:1.1em; color:#444;">3 Types of Orgs in our MA Immigrant Rights Coalition</p>

      <details style="margin-top:1.5em; border:1px solid #ddd; border-radius:6px; padding:0.5em 1em;">
        <summary style="cursor:pointer; font-weight:bold; font-size:1.1em; color:#0066cc; padding:0.5em 0;">
          1. Detention Prevention &mdash; LUCE!
        </summary>
        <div style="padding:0.5em 0;">
          <p><strong>LUCE:</strong> "I think I might see ICE" Hotline + Local Hubs statewide (Massachusetts).</p>
          <p>Website: <a href="https://LUCEMass.org" target="_blank">LUCEMass.org</a></p>
          <p><strong>LUCE Hotline:</strong> <a href="tel:6173705023">617-370-5023</a></p>
          <p><strong>Volunteer Needs:</strong></p>
          <ul>
            <li><strong>Trained Verifiers</strong> &mdash; check if ICE vs. Not ICE. Clarify, Inform, Report, Alert, + Deescalate!</li>
            <li><strong>Canvassers</strong> &mdash; share helpful materials with neighbors, observers, houses of worship, + deputize others!</li>
            <li><strong>Hotline Workers</strong> &mdash; calls and texts, many languages needed!</li>
            <li><strong>Materials + Organization</strong> &mdash; canvassing resource bundles!</li>
          </ul>
        </div>
      </details>

      <details style="margin-top:1em; border:1px solid #ddd; border-radius:6px; padding:0.5em 1em;">
        <summary style="cursor:pointer; font-weight:bold; font-size:1.1em; color:#0066cc; padding:0.5em 0;">
          2. Community Connection &mdash; BIJAN!
        </summary>
        <div style="padding:0.5em 0;">
          <p><strong>BIJAN:</strong> Resources and Connection for People Abducted by ICE, Detained, Deported, and their Loved Ones.</p>
          <p>Website: <a href="https://BeyondBondBoston.org/join" target="_blank">BeyondBondBoston.org/join</a></p>
          <p><strong>Family Hotline</strong> (for Family, Lawyers, + Organizations): <a href="tel:6176378195">617-637-8195</a></p>
          <p><strong>Detained Hotline</strong> (for people in Detention): <a href="tel:6173967143">617-396-7143</a></p>
        </div>
      </details>

      <details style="margin-top:1em; border:1px solid #ddd; border-radius:6px; padding:0.5em 1em;">
        <summary style="cursor:pointer; font-weight:bold; font-size:1.1em; color:#0066cc; padding:0.5em 0;">
          3. Liberation! &mdash; PAIR!
        </summary>
        <div style="padding:0.5em 0;">
          <p><strong>PAIR Project:</strong> Resources and Legal Representation for People Abducted + Detained by ICE. Pro Bono!</p>
          <p>Website: <a href="https://PAIRproject.org" target="_blank">PAIRproject.org</a></p>
          <p><strong>Asylum Help:</strong> <a href="mailto:Asylum@PAIRproject.org">Asylum@PAIRproject.org</a></p>
          <p><strong>Detention Help:</strong> <a href="mailto:Detention@PAIRproject.org">Detention@PAIRproject.org</a></p>
          <p><strong>Know Your Rights:</strong> <a href="mailto:KYRS@PAIRproject.org">KYRS@PAIRproject.org</a> (Trainings + Workshops)</p>
          <p><strong>Volunteer:</strong> <a href="https://PAIRproject.org/SupportUs" target="_blank">PAIRproject.org/SupportUs</a> (Legal and non-Legal opportunities)</p>
        </div>
      </details>
    </div>
  </div>

  <!-- Archive section -->
  <div class="container" id="archive-section" style="display:none;">
    <h2 style="color:#0066cc;">Past Featured Coffees</h2>
    <div id="archive-list"></div>
  </div>

  <script src="coffee-archives.js"></script>
  <script>
    // Tab switching logic with URL hash support
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
      document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
      var btn = document.querySelector('.tab-btn[data-tab="' + tabName + '"]');
      var content = document.getElementById('tab-' + tabName);
      if (btn && content) {
        btn.classList.add('active');
        content.classList.add('active');
      }
    }

    document.querySelectorAll('.tab-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var tab = btn.dataset.tab;
        window.location.hash = tab;
        switchTab(tab);
      });
    });

    // Set tab from URL hash on load (default to fundraiser)
    var hash = window.location.hash.replace('#', '');
    switchTab(hash === 'actions' ? 'actions' : 'fundraiser');

    // Handle back/forward navigation
    window.addEventListener('hashchange', function() {
      var h = window.location.hash.replace('#', '');
      switchTab(h === 'actions' ? 'actions' : 'fundraiser');
    });

    // Render archive links if any exist
    if (typeof COFFEE_ARCHIVES !== 'undefined' && COFFEE_ARCHIVES.length > 0) {
      var archiveSection = document.getElementById('archive-section');
      var archiveList = document.getElementById('archive-list');
      archiveSection.style.display = '';
      var html = '';
      for (var i = 0; i < COFFEE_ARCHIVES.length; i++) {
        var a = COFFEE_ARCHIVES[i];
        html += '<p style="margin:0.5em 0;"><a href="' + a.file + '">' + a.date + ': ' + a.title + '</a></p>';
      }
      archiveList.innerHTML = html;
    }

    // Use correct backend URL based on environment
    const API_BASE = window.location.hostname === 'localhost'
      ? ''
      : 'https://api.fixice.org';

    function openGivebutter(amount, frequency) {
      const url = `https://givebutter.com/NSLUCE/donate?amount=${encodeURIComponent(amount)}&frequency=${encodeURIComponent(frequency)}`;
      window.open(url, '_blank');
    }

    async function handleDonate(frequency) {
      const amount = document.getElementById('amount').value;
      if (!amount || isNaN(amount) || Number(amount) <= 0) {
        alert('Please enter a valid donation amount.');
        return;
      }
      // Open Givebutter immediately in a new tab
      openGivebutter(amount, frequency);
      // Save to backend (PostgreSQL)
      try {
        await fetch(API_BASE + '/api/log-donation', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount, frequency })
        });
      } catch (err) {
        // Optionally log error or ignore
      }
    }
    document.getElementById('donate-once').addEventListener('click', function() {
      handleDonate('once');
    });
    document.getElementById('donate-monthly').addEventListener('click', function() {
      handleDonate('monthly');
    });

    // List all donations button logic
    document.getElementById('list-donations-btn').addEventListener('click', async function() {
      const listDiv = document.getElementById('donations-list');
      listDiv.style.display = 'block';
      listDiv.innerHTML = 'Loading...';
      try {
        const resp = await fetch(API_BASE + '/api/list-donations');
        if (!resp.ok) throw new Error('Failed to fetch');
        const data = await resp.json();
        if (!Array.isArray(data.donations) || data.donations.length === 0) {
          listDiv.innerHTML = '<em>No donations recorded yet.</em>';
          return;
        }
        let html = '<table style="width:100%;border-collapse:collapse;"><tr><th style="text-align:left;">Amount</th><th style="text-align:left;">Frequency</th><th style="text-align:left;">Date</th></tr>';
        for (const d of data.donations) {
          let dateStr = '';
          if (d.created_at) {
            const dateObj = new Date(d.created_at);
            dateStr = dateObj.toLocaleDateString();
          }
          html += `<tr><td>$${Number(d.amount).toFixed(2)}</td><td>${d.frequency}</td><td>${dateStr}</td></tr>`;
        }
        html += '</table>';
        html += `<div style='margin-top:1em;font-weight:bold;'>Total: $${Number(data.total).toFixed(2)}</div>`;
        listDiv.innerHTML = html;
      } catch (err) {
        listDiv.innerHTML = '<span style="color:red;">Error loading donations.</span>';
      }
    });
  </script>
  <script src="menu.js"></script>
  <script>
    if (typeof initMenu === 'function') {
      initMenu();
    } else {
      window.addEventListener('DOMContentLoaded', function() {
        if (typeof initMenu === 'function') initMenu();
      });
    }
  </script>
</body>
</html>
