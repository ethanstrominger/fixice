<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Link Tag Explorer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="menu-container"></div>
  <main style="max-width:700px;margin:2em auto 0 auto;padding:1.5em;background:#fff;border-radius:8px;box-shadow:0 2px 8px #0001;">
    <h2>Explore Links by Activity or Cause</h2>
    <div class="tag-filter">
      <label for="activity">Activity:</label>
      <select id="activity">
        <option value="">-- Select Activity --</option>
        <option value="advocate">Advocate</option>
        <option value="volunteer">Volunteer</option>
        <option value="donate">Donate</option>
        <option value="learn">Learn</option>
      </select>
      <label for="cause">Cause:</label>
      <select id="cause">
        <option value="">-- Select Cause --</option>
        <option value="Immigration">Immigration</option>
        <option value="Anti-ICE">Anti-ICE</option>
        <option value="Elections">Elections</option>
      </select>
    </div>
    <div class="tag-list" id="tag-list"></div>
  </main>
  <script>
    fetch('menu-experimental.html').then(r => r.text()).then(html => {
      document.getElementById('menu-container').innerHTML = html;
    });

    // Parse link-list.txt and render all records
    async function loadLinks() {
      const res = await fetch('link-list.txt');
      const txt = await res.text();
      const records = [];
      let rec = {};
      txt.split('\n').forEach(line => {
        if (line.startsWith('Link: ')) {
          rec.link = line.replace('Link: ', '').trim();
        } else if (line.startsWith('Description: ')) {
          rec.description = line.replace('Description: ', '').trim();
        } else if (line.startsWith('Activities: ')) {
          rec.activities = line.replace('Activities: ', '').trim();
        } else if (line.startsWith('Cause: ')) {
          rec.cause = line.replace('Cause: ', '').trim();
        } else if (line.trim() === '') {
          if (rec.description && rec.activities && rec.cause) {
            records.push(rec);
          }
          rec = {};
        }
      });
      // Handle last record
      if (rec.description && rec.activities && rec.cause) {
        records.push(rec);
      }
      return records;
    }

    function renderLinks(records) {
      const tagList = document.getElementById('tag-list');
      tagList.innerHTML = '';
      records.forEach(rec => {
        const div = document.createElement('div');
        div.className = 'tag-record';
        let descHtml = rec.link ? `<a href="${rec.link}" target="_blank">${rec.description}</a>` : rec.description;
        div.innerHTML = `${descHtml} <span style="color:#888;font-size:0.95em;">â€” Activities: ${rec.activities} | Cause: ${rec.cause}</span>`;
        tagList.appendChild(div);
      });
    }

    let allRecords = [];
    let selectedActivity = '';
    let selectedCause = '';

    function filterLinks() {
      let filtered = allRecords;
      if (selectedActivity) {
        filtered = filtered.filter(rec => rec.activities.toLowerCase().split(',').map(a => a.trim()).includes(selectedActivity.toLowerCase()));
      } else if (selectedCause) {
        filtered = filtered.filter(rec => rec.cause.toLowerCase() === selectedCause.toLowerCase());
      }
      renderLinks(filtered);
    }

    document.getElementById('activity').addEventListener('change', e => {
      selectedActivity = e.target.value;
      if (selectedActivity) {
        selectedCause = '';
        document.getElementById('cause').value = '';
      }
      filterLinks();
    });
    document.getElementById('cause').addEventListener('change', e => {
      selectedCause = e.target.value;
      if (selectedCause) {
        selectedActivity = '';
        document.getElementById('activity').value = '';
      }
      filterLinks();
    });

    // Initial load
    loadLinks().then(records => {
      allRecords = records;
      renderLinks(allRecords);
    });
  </script>
</body>
</html>