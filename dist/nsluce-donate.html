<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- File replaced by weekly-fundraiser.html -->
  <style>
    body { font-family: sans-serif; background: #f8f8f8; margin: 0; padding: 0; }
    .container { max-width: 500px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 2em; }
    h1 { color: #0066cc; }
    label { display: block; margin-top: 1.5em; font-weight: bold; }
    input[type="number"] { width: 100%; padding: 0.5em; font-size: 1.1em; margin-top: 0.5em; }
    button { margin-top: 1.5em; background: #0066cc; color: #fff; border: none; padding: 0.7em 1.5em; border-radius: 4px; font-size: 1.1em; cursor: pointer; }
    .links { margin-top: 2em; }
    .links a { display: block; margin-bottom: 0.7em; color: #0066cc; text-decoration: underline; }
    .success { color: green; margin-top: 1em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Monthly Fundraiser</h1>
    <p style="font-size:1.1em; color:#444; margin-bottom:1.5em;">Every Wednesday there will be a new fundraiser.</p>
    <form id="donation-form">
      <label for="amount">Donation Amount</label>
      <input type="number" id="amount" name="amount" min="1" step="any" placeholder="Enter amount (USD)" required>
      <div style="margin-top:1.5em; display:flex; gap:1em;">
        <button type="button" id="donate-once" style="flex:1; background:#0066cc;">Donate Once</button>
        <button type="button" id="donate-monthly" style="flex:1; background:#009966;">Donate Monthly</button>
      </div>
      <div class="success" id="success-message" style="display:none;">Thank you! Your donation has been recorded.</div>
    </form>
    <!-- LUCE Mass logo and visit text removed as requested -->
    <div class="links">
      <a href="https://givebutter.com/NSLUCE" target="_blank">Information about North Shore LUCE</a>
      <a href="https://givebutter.com/NSLUCE/donate" target="_blank">Donate to North Shore LUCE</a>
      <a href="https://lucemass.org" target="_blank">lucemass.org</a>
    </div>
    <button id="list-donations-btn" type="button" style="background:#888; margin-top:1em;">List All Donations</button>
    <div id="donations-list" style="margin-top:1.5em; display:none;"></div>
    <!-- total recorded removed as requested -->
  </div>
  <script>

        async function handleDonate(frequency) {
          const amount = document.getElementById('amount').value;
          if (!amount || isNaN(amount) || Number(amount) <= 0) {
            alert('Please enter a valid donation amount.');
            return;
          }
          let saveOk = false;
          try {
            const resp = await fetch('/api/log-donation', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ amount, frequency })
            });
            if (resp.ok) saveOk = true;
          } catch (err) {
            saveOk = false;
          }
          if (saveOk) {
            // Redirect to Givebutter with prefilled amount and frequency
            window.location.href = `https://givebutter.com/NSLUCE/donate?amount=${encodeURIComponent(amount)}&frequency=${encodeURIComponent(frequency)}`;
          } else {
            alert('Unable to save to fixice.org. Please use North Shore LUCE web page.');
            window.location.href = 'https://givebutter.com/NSLUCE/donate';
          }
        }
        document.getElementById('donate-once').addEventListener('click', function() {
          handleDonate('once');
        });
        document.getElementById('donate-monthly').addEventListener('click', function() {
          handleDonate('monthly');
        });

    // List all donations button logic
    document.getElementById('list-donations-btn').addEventListener('click', async function() {
      const listDiv = document.getElementById('donations-list');
      listDiv.style.display = 'block';
      listDiv.innerHTML = 'Loading...';
      try {
        const resp = await fetch('/api/list-donations');
        if (!resp.ok) throw new Error('Failed to fetch');
        const data = await resp.json();
        if (!Array.isArray(data.donations) || data.donations.length === 0) {
          listDiv.innerHTML = '<em>No donations recorded yet.</em>';
          return;
        }
        let html = '<table style="width:100%;border-collapse:collapse;"><tr><th style="text-align:left;">Amount</th><th style="text-align:left;">Frequency</th><th style="text-align:left;">Date</th></tr>';
        for (const d of data.donations) {
          let dateStr = '';
          if (d.created_at) {
            const dateObj = new Date(d.created_at);
            dateStr = dateObj.toLocaleDateString();
          }
          html += `<tr><td>$${Number(d.amount).toFixed(2)}</td><td>${d.frequency}</td><td>${dateStr}</td></tr>`;
        }
        html += '</table>';
        html += `<div style='margin-top:1em;font-weight:bold;'>Total: $${Number(data.total).toFixed(2)}</div>`;
        listDiv.innerHTML = html;
      } catch (err) {
        listDiv.innerHTML = '<span style="color:red;">Error loading donations.</span>';
      }
    });
  </script>
</body>
</html>
